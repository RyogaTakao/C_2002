<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>文章補完機能</title>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="tiny_segmenter-0.2.js" type="text/javascript"></script>
    <script type="text/javascript">

      var businessIdioms = [
        ["お世話になっております。", "おせわになっております。"],
        ["早速のお返事ありがとうございました。", ""],
        ["よろしくお願いいたします。", "よろしくおねがいいたします。"],
        ["お返事お待ちしております。", "おへんじおまちしております。"],
        ["お手数をおかけしますが、", "おてすうをおかけしますが、"],
        ["引き続きよろしくお願いいたします。", "ひきつづきよろしくおねがいいいたします"],
        ["ますますのご活躍をお祈り申し上げます。", "ますますのごかつやくをおいのりもうしあげます。"],
        ["申し訳ございません。", "もうしわけございません"],
        ["今後ともよろしくお願い申し上げます。", "こんごともよろしくおねがいもうしあげます。"],
        ["ご無沙汰しております。", "ごぶさたしております"],

      ];
  
      jQuery(function(){  
        jQuery('#new_message').autocomplete({
          source: function(request, response){
            var suggestionList = [];
                segForSuggestion = new TinySegmenter();  
                morphForSuggestion = segForSuggestion.segment(request.term);
                unfinishedWord = morphForSuggestion.slice(-1)[0]; 
                regexp = new RegExp('^' + unfinishedWord + '.*$');
            
            jQuery.each(businessIdioms, function(i, businessIdiom) {
              if (unfinishedWord.length >= 2) {
                if (businessIdiom[0].match(regexp) || businessIdiom[1].match(regexp)) {
                  suggestionList.push(businessIdiom[0]);
                } 
              }  
            });

            response(suggestionList);
          },

          select: function (event, selectedPhrase) {  
            var segForSelection = new TinySegmenter();  
                morphForSelection= segForSelection.segment(this.value); 
            
            morphForSelection.pop();
            if (typeof(morphForSelection)=="string") {
              // ↓テキストボックスに消したい要素が入った(補完前の途中のひらがなだけ)リストが文字列に変化するので、新規で作成している
              var newMorphForSelection = [];
              newMorphForSelection.push(selectedPhrase.item.value);
              this.value = newMorphForSelection.join("");
            } else {
              morphForSelection.push(selectedPhrase.item.value);
              this.value = morphForSelection.join("")
            }
            return false;
          },
          autoFocus: true,
          delay: 300,
          minLength: 2,
          position: { my : "left bottom", at: "left top" },
        });
      });
      </script>
  </head>
  <body>
    <div class="ui_widget" style="position: absolute; width: 100%;margin: 100px; text-align: center;">
      <textarea id="new_message" cols="60" rows="20" placeholder="メール入力"></textarea>
    </div>
  </body>
</html>